<meta charset="UTF-16">
<body bgcolor="#faebd7">
<canvas id=canvas width="800" height="800"></canvas>
<br/><br/>
<br>
<span style="color: black; font-family: Arial,serif; ">
        © Лыскин Данил, Щелочков Александр, Алиев Руслан
    </span>

<script>

    const cw = canvas.width, ch = canvas.height;
    const ctx = document.getElementById("canvas").getContext("2d");
    var mX = 150;
    var mY = 50;
    const del = 20;

    function drawArrow(cx, x, y, fromX, fromY) {
        const headlen = 10;
        const angle = Math.atan2(y - fromY, x - fromX);
        cx.moveTo(x, y);
        cx.lineTo(x - headlen * Math.cos(angle - Math.PI / 6), y - headlen * Math.sin(angle - Math.PI / 6));
        cx.moveTo(x, y);
        cx.lineTo(x - headlen * Math.cos(angle + Math.PI / 6), y - headlen * Math.sin(angle + Math.PI / 6));
    }

    function drawGrid() {
        var cx = document.querySelector("canvas").getContext("2d");
        cx.beginPath();
        cx.moveTo(del, 0);
        cx.lineTo(del, canvas.height - del);
        drawArrow(cx, del, 0, del, canvas.height - del);
        cx.moveTo(0, canvas.height / 2 - del + canvas.height / 3);
        cx.lineTo(canvas.width + del, canvas.height / 2 - del + canvas.height / 3);
        drawArrow(cx, canvas.width, canvas.height / 2 - del + canvas.height / 3, del, canvas.height / 2 - del + canvas.height / 3);

        let y = canvas.height / 2 - del + canvas.height / 3;
        let cnt = 0;

        let yDel = (0.2 * 0.5 * Math.log10(0.5) + Math.pow(0.5 - 2.3, 2)) - (0.2 * 0.6 * Math.log10(0.6) + Math.pow(0.6 - 2.3, 2));

        for (let x = 0, yH = 0; x < cw; x += 0.2, yH += yDel, cnt++) {
            let tmpX = x * mX;

            ctx.fillText(x.toFixed(1), tmpX + del / 2, y + del / 2);
            if (yH !== 0) {
                ctx.fillText(yH.toFixed(1), 0, (ch / 2) - del + (ch / 3) - yH * mY);
            }
            if (!(cnt % 25)) {
                cx.moveTo(x, (ch / 2) - 2 - del + ch / 3);
                cx.lineTo(x, (ch / 2) + 2 - del + ch / 3);
                if (yH < ch) {
                    cx.moveTo(del - 2, (ch / 2) - del + (ch / 3) - yH);
                    cx.lineTo(del + 2, (ch / 2) - del + (ch / 3) - yH);
                }
            }
        }
        cx.stroke();
    }

    function draw() {
        var xLast = del;
        var yLast = ch / 2 + ch / 3;

        var cx = document.querySelector("canvas").getContext("2d");
        cx.beginPath();

        let cnt = 0;

        for (x = 0.5; x < cw; x += 0.1, cnt++) {
            const y = 0.2 * x * Math.log10(x) + Math.pow(x - 2.3, 2);
            ctx.fillRect(x * mX + del, ch - (y * mY + ch / 2) - del + ch / 3, 1, 1);
            if (cnt !== 0) {
                cx.moveTo(xLast, yLast);
                cx.lineTo(x * mX + del, ch - (y * mY + ch / 2) - del + ch / 3);
            }

            xLast = x * mX + del;
            yLast = ch - (y * mY + ch / 2) - del + ch / 3;
        }
        cx.stroke();
    }

    function reDraw() {
        ctx.clearRect(0, 0, cw, ch);
        drawGrid();
        draw();
    }

    function drawIteration() {
        const request = require('request');

// request.post(
//     'http://localhost:8889/api/change/method/Brent',
//     { json: { key: 'value' } },
//     function (error, response, body) {
//         if (!error && response.statusCode === 200) {
//             console.log(body);
//         }
//     }
// );
        var cx = document.querySelector("canvas").getContext("2d");
        cx.beginPath();

        for (let i = 0; i < 30; i++) {
            request.get(
                'http://localhost:8889/api/get/result/0.5/2.5/30',
                {json: {key: 'value'}},
                function (error, response, body) {
                    if (!error && response.statusCode === 200) {
                        const y = 0.2 * x * Math.log10(x) + Math.pow(x - 2.3, 2);
                        ctx.fillRect(x * mX + del, ch - (y * mY + ch / 2) - del + ch / 3, 2, 2);
                        // console.log(body);
                    }
                }
            );
            sleep(300);
        }
        cx.stroke();
    }

    drawGrid();
    draw();

</script>
</body>
